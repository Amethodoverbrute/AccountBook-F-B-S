# 实现账单分页功能计划

## 1. 需求分析
- 支持每页显示5/10/20/50条账单
- 支持上一页/下一页导航
- 支持直接跳转到指定页码
- 显示当前页码和总页数
- 显示总记录数
- 与现有搜索功能兼容

## 2. 实现步骤

### 2.1 后端修改（account.js）
1. **修改GET /account路由**：
   - 添加page和pageSize查询参数
   - 使用MongoDB的skip()和limit()方法实现分页
   - 返回总记录数和分页数据
   - 更新Swagger文档

2. **实现逻辑**：
   - 默认page=1，pageSize=10
   - 计算skip数量：(page-1)*pageSize
   - 使用countDocuments()获取总记录数

### 2.2 前端修改（Home.vue）
1. **添加分页组件UI**：
   - 每页显示条数选择器
   - 分页导航按钮（上一页/下一页/首页/末页）
   - 页码输入框和跳转按钮
   - 分页信息显示（当前页/总页数/总记录数）

2. **添加分页状态管理**：
   - currentPage：当前页码
   - pageSize：每页显示条数
   - totalRecords：总记录数
   - totalPages：总页数

3. **修改fetchAccounts函数**：
   - 支持传递page和pageSize参数
   - 处理后端返回的分页数据
   - 更新分页状态

4. **实现分页逻辑**：
   - 切换每页显示条数
   - 页码跳转
   - 上一页/下一页导航
   - 边界条件处理

### 2.3 前端服务修改（auth.js）
1. **更新getAccounts函数**：
   - 支持接收page和pageSize参数
   - 将参数传递给后端API

## 3. 技术实现

### 3.1 后端实现
```javascript
// 分页查询
const page = parseInt(req.query.page) || 1;
const pageSize = parseInt(req.query.pageSize) || 10;
const skip = (page - 1) * pageSize;

// 获取总记录数
const total = await AccountModel.countDocuments(query);

// 分页查询数据
const data = await AccountModel.find(query)
  .sort({ time: -1 })
  .skip(skip)
  .limit(pageSize);

// 返回分页数据
res.json({
  code: "0000",
  msg: "获取数据成功",
  data: {
    accounts: data,
    pagination: {
      page,
      pageSize,
      total,
      totalPages: Math.ceil(total / pageSize)
    }
  }
});
```

### 3.2 前端实现
```vue
<!-- 分页组件 -->
<div class="pagination-container">
  <div class="pagination-info">
    共 {{ totalRecords }} 条记录，第 {{ currentPage }}/{{ totalPages }} 页
  </div>
  <div class="pagination-controls">
    <select v-model="pageSize" @change="handlePageSizeChange">
      <option :value="5">5条/页</option>
      <option :value="10">10条/页</option>
      <option :value="20">20条/页</option>
      <option :value="50">50条/页</option>
    </select>
    <button @click="goToPage(1)" :disabled="currentPage === 1">首页</button>
    <button @click="goToPage(currentPage - 1)" :disabled="currentPage === 1">上一页</button>
    <div class="page-input">
      <input type="number" v-model="jumpPage" min="1" :max="totalPages" />
      <button @click="goToPage(jumpPage)">跳转</button>
    </div>
    <button @click="goToPage(currentPage + 1)" :disabled="currentPage === totalPages">下一页</button>
    <button @click="goToPage(totalPages)" :disabled="currentPage === totalPages">末页</button>
  </div>
</div>
```

## 4. 代码修改点

### 4.1 后端修改点（account.js）
- **GET /account路由**：添加分页逻辑
- **Swagger文档**：添加page和pageSize参数说明

### 4.2 前端修改点（Home.vue）
- **模板部分**：添加分页组件
- **脚本部分**：添加分页状态和逻辑
- **样式部分**：添加分页组件样式

### 4.3 前端服务修改点（auth.js）
- **getAccounts函数**：添加分页参数支持

## 5. 预期效果
- 用户可以选择每页显示条数
- 可以通过按钮导航到上一页/下一页
- 可以直接跳转到指定页码
- 显示当前页码、总页数和总记录数
- 与现有搜索功能兼容

## 6. 测试计划
1. 测试默认分页（10条/页）
2. 测试不同每页显示条数的切换
3. 测试上一页/下一页导航
4. 测试跳转到指定页码
5. 测试边界条件（首页、末页）
6. 测试与搜索功能的兼容性

## 7. 实现顺序
1. 后端API修改
2. 前端服务修改
3. 前端状态管理添加
4. 前端UI组件添加
5. 前端逻辑实现
6. 测试和优化